// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  HR
  CANDIDATE
  ADMIN
}

model User {
  id        String   @id @default(nanoid())
  fullname  String
  username  String   @unique
  email     String   @unique
  password  String
  role      Role
  createdAt DateTime @default(now())

  hrProfile        HRProfile? // one-to-one relation to HRProfile
  candidateProfile CandidateProfile? // one-to-one relation to CandidateProfile
}

model HRProfile {
  id     String @id @default(nanoid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  jobs Job[]
}

model CandidateProfile {
  id              String        @id @default(nanoid())
  userId          String        @unique
  user            User          @relation(fields: [userId], references: [id])
  experienceYears Float?
  resumes         Resume[]
  matches         MatchResult[]
}

model Resume {
  id           String           @id @default(nanoid())
  candidateId  String
  candidate    CandidateProfile @relation(fields: [candidateId], references: [id]) //
  rawText      String
  extractedAt  DateTime         @default(now())
  resumeSkills ResumeSkill[]
}

model Job {
  id            String        @id @default(nanoid())
  hrId          String
  hr            HRProfile     @relation(fields: [hrId], references: [id])
  title         String
  description   String
  minExperience Float?
  createdAt     DateTime      @default(now())
  jobSkills     JobSkill[]
  matches       MatchResult[]
}

model Skill {
  id            String         @id @default(nanoid())
  name          String         @unique
  category      String?
  jobSkills     JobSkill[]
  resumeSkills  ResumeSkill[]
  missingSkills MissingSkill[]
}

model JobSkill {
  id       String  @id @default(nanoid())
  jobId    String
  skillId  String
  weight   Float   @default(1.0)
  required Boolean @default(true)
  job      Job     @relation(fields: [jobId], references: [id])
  skill    Skill   @relation(fields: [skillId], references: [id])

  @@unique([jobId, skillId])
}

model ResumeSkill {
  id         String @id @default(nanoid())
  resumeId   String
  skillId    String
  confidence Float? // optional AI confidence score
  resume     Resume @relation(fields: [resumeId], references: [id])
  skill      Skill  @relation(fields: [skillId], references: [id])

  @@unique([resumeId, skillId])
}

model MatchResult {
  id            String           @id @default(nanoid())
  candidateId   String
  jobId         String
  score         Float
  createdAt     DateTime         @default(now())
  candidate     CandidateProfile @relation(fields: [candidateId], references: [id])
  job           Job              @relation(fields: [jobId], references: [id])
  missingSkills MissingSkill[]
}

model MissingSkill {
  id            String      @id @default(nanoid())
  matchResultId String
  skillId       String
  priority      String? // High / Medium / Low
  matchResult   MatchResult @relation(fields: [matchResultId], references: [id])
  skill         Skill       @relation(fields: [skillId], references: [id])
}
